[h]Singleton (1)[/h]

[code=php]#Singleton (Синглтон, одиночка) относиться к классу порождающих паттернов.
#Он используется для создания всего одного экземпляра класса, и гарантирует,
#что во время работы программы не появиться второй. Например в схеме MVC,
#зачастую этот паттерн используется для порождения главного контроллера (фронтового)

<?php
class Singleton {
  private static $instance = null;
 
  private function __construct() {}
  private function __clone() {}
  private function __sleep() {}

  public static function getInstance() {
    if (self::$instance === null) {
      self::$instance = new self;
    }
    return self::$instance;
  }
 
  public function doAction() {
    #...
  }
}


//Использование
Singleton::getInstance()->doAction();
$Object = Singleton::getInstance();

$Object->doAction();
Singleton::getInstance()->doAction();

?>
[/code]
[h]Singleton (2)[/h]

[code=php]Singleton (Синглтон, одиночка) Вариант 2

#Описание - Шаблон singleton позволяет создавать лишь один экземпляр класса в течении работы приложения. Это даёт ряд преимуществ:
// Глобальный доступ к объекту
// Уверенность в том что есть только один экземпляр класса
// Контроль доступа к данным

#Глобальные переменные создают ряд проблем:
// Засоряют область видимости
// Их можно случайно затереть
// Не инкапсулируют доступ к данным
// Тяжело отслеживать их доступность на разных уровнях приложения

#Применение - Применять данный шаблон можно для многих задач. Наиболее часто он применяется для следующих целей:
// Осуществление доступа к данным или функционалу на различных уровнях приложения. Например абстракция над http запросом и осуществление доступа к нему из контроллеров и видов приложения (для MVC архитектуры)
// Абстракция над доступом к ресурсам. Например, контроль за тем чтобы в приложении создавался всего одно соединение с базой данных, ресурс которого сохраняется в объекте-одиночке.

<?php
// ...
class Singleton{
    //Экземпляр объекта Singleton
    static protected $instance = null;
    //Метод предоставляет доступ к объекту
    static public function getInstance(){
        if (is_null(self::$instance))
            self::$instance = new Singleton();
        return self::$instance;
    }
    //Закрытый конструктор
    private function __construct(){
    echo 'New instance!' . "\n";
    }

    private function __clone(){}

    public function someAction(){
    echo 'Some action!' . "\n";
    }
}

#Экземпляр класса хранится в приватной статической переменной $instance и доступ к нему осуществляется через открытый статический метод getInstance. Теперь рассмотрим, как применять данный класс:

<?php
// ...
Singleton::getInstance()->someAction();
Singleton::getInstance()->someAction();


/* 
// В результате получаем следующий вывод:
New instance!
Some action!
Some action!
// Как Вы видите конструктор вызывается только 1 раз для 2х вызовов метода getInstance.
*/[/code]
[h]Singleton (1) (ВИКИ)[/h]
[code=php]<?php
 class Singleton {
    protected static $instance;  // object instance
    private function __construct(){ /* ... @return Singleton */ }  // Защищаем от создания через new Singleton
    private function __clone()    { /* ... @return Singleton */ }  // Защищаем от создания через клонирование
    private function __wakeup()   { /* ... @return Singleton */ }  // Защищаем от создания через unserialize
    public static function getInstance() {    // Возвращает единственный экземпляр класса. @return Singleton
        if ( !isset(self::$instance) ) {
            $class = __CLASS__;
            self::$instance = new $class();
            return self::$instance;
        }
        return self::$instance;
    }
    public function doAction() { /* ... */ }
 }
 Singleton::getInstance()->doAction(); // Применение
?>[/code]






